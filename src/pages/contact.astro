---
import Layout from '../layouts/Layout.astro';
import Icon from '../components/Icon.astro';
import Button from '../components/Button.astro';
---

<Layout title="Contacto | Wiñay Tech">

  <section class="py-20 md:py-28 bg-background-light dark:bg-background-dark">
    <div class="container mx-auto px-4">

      <div class="max-w-3xl mx-auto text-center mb-16">
        <h1 class="text-4xl md:text-5xl font-display font-bold text-text-light dark:text-text-dark">
          Cuéntanos tu idea. La convertimos en realidad.
        </h1>
        <p class="mt-4 text-lg text-text-light/80 dark:text-text-dark/80">
          El primer paso es el más importante. Rellena este formulario o, si lo prefieres, escríbenos por WhatsApp. Te responderemos sin jerga técnica y con un plan claro para tu negocio.
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12">

        <!-- Formulario -->
        <div class="lg:col-span-2 p-8 rounded-xl shadow-xl bg-white dark:bg-background-dark border border-accent-light/20 dark:border-accent-soft/20">
          <form
            name="contact"
            class="space-y-6"
            x-data="{
                formData: { name: '', email: '', service: '', message: '' },
                loading: false,
                success: false,
                error: '',
                async submitForm() {
                    this.loading = true;
                    this.error = '';
                    try {
                        const response = await fetch('https://skinnypizza.app.n8n.cloud/webhook-test/winay-lead', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.formData)
                        });
                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({ message: response.statusText }));
                            throw new Error(errorData.message || 'Algo salió mal. Por favor, inténtalo de nuevo.');
                        }
                        this.success = true;
                        this.formData = { name: '', email: '', service: '', message: '' };
                    } catch (error) {
                        this.error = error.message;
                    } finally {
                        this.loading = false;
                    }
                }
            }"
            @submit.prevent="submitForm"
          >
            <template x-if="success">
              <div class="p-4 text-green-800 bg-green-100 rounded-lg dark:bg-green-200 dark:text-green-900" role="alert">
                ¡Gracias por tu mensaje! Nos pondremos en contacto contigo muy pronto.
              </div>
            </template>
            <template x-if="error">
              <div class="p-4 text-red-800 bg-red-100 rounded-lg dark:bg-red-200 dark:text-red-900" role="alert">
                <span x-text="error"></span>
              </div>
            </template>

            <div x-show="!success" class="space-y-6">
              <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                <div>
                  <label for="name" class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Nombre</label>
                  <input type="text" id="name" name="name" x-model="formData.name" required class="w-full rounded-lg border-accent-light/50 focus:border-primary focus:ring-primary bg-background-light dark:bg-accent-soft/30 p-3">
                </div>
                <div>
                  <label for="email" class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Correo Electrónico</label>
                  <input type="email" id="email" name="email" x-model="formData.email" required class="w-full rounded-lg border-accent-light/50 focus:border-primary focus:ring-primary bg-background-light dark:bg-accent-soft/30 p-3">
                </div>
              </div>

              <div>
                <label for="service" class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Servicio de Interés</label>
                <select id="service" name="service" x-model="formData.service" required class="w-full rounded-lg border-accent-light/50 focus:border-primary focus:ring-primary bg-background-light dark:bg-accent-soft/30 p-3">
                  <option value="">Selecciona un plan o servicio</option>
                  <option value="Plan Landing Page">Plan Landing Page</option>
                  <option value="Plan Web Corporativa">Plan Web Corporativa</option>
                  <option value="Copywriting">Copywriting</option>
                  <option value="Mantenimiento Mensual">Mantenimiento Mensual</option>
                  <option value="SEO Avanzado">SEO Avanzado</option>
                  <option value="Correos Corporativos">Correos Corporativos</option>
                  <option value="Otro">Otro / No estoy seguro</option>
                </select>
              </div>

              <div>
                <label for="message" class="block text-sm font-medium text-text-light dark:text-text-dark mb-1">Cuéntanos sobre tu proyecto</label>
                <textarea id="message" name="message" rows="5" x-model="formData.message" required class="w-full rounded-lg border-accent-light/50 focus:border-primary focus:ring-primary bg-background-light dark:bg-accent-soft/30 p-3" placeholder="Describe lo que necesitas, tus metas, o cualquier duda que tengas..."></textarea>
              </div>

              <button type="submit" :disabled="loading" class="w-full flex justify-center items-center h-12 px-6 rounded-lg bg-primary text-text-dark font-bold hover:bg-opacity-90 transition-all transform hover:scale-[1.02] disabled:opacity-50">
                <span x-show="!loading">Enviar Mensaje</span>
                <span x-show="loading">Enviando...</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Info de Contacto -->
        <div class="space-y-8">
          <div class="bg-primary/10 dark:bg-accent-soft/20 p-6 rounded-xl">
            <Icon name="whatsapp" class="text-3xl text-primary mb-3" />
            <h3 class="text-xl font-display font-semibold mb-2">Escríbenos por WhatsApp</h3>
            <p class="text-text-light/80 dark:text-text-dark/80 mb-4">La forma más rápida de hablar con nosotros. Ideal para consultas rápidas.</p>
            <a href="https://wa.me/591XXXXXXXX" target="_blank" class="font-bold text-primary hover:underline">
              Iniciar Chat &rarr;
            </a>
          </div>
          <div class="bg-primary/10 dark:bg-accent-soft/20 p-6 rounded-xl">
            <Icon name="mail" class="text-3xl text-primary mb-3" />
            <h3 class="text-xl font-display font-semibold mb-2">Correo Electrónico</h3>
            <p class="text-text-light/80 dark:text-text-dark/80 mb-4">Para consultas más detalladas o si prefieres escribir con calma.</p>
            <a href="mailto:info@winay.tech" class="font-bold text-primary hover:underline">
              info@winay.tech
            </a>
          </div>
        </div>

      </div>
    </div>
  </section>

</Layout>

<style>
  .animate-fade-in-up {
    animation: fade-in-up 0.6s ease-out forwards;
    animation-delay: var(--anim-delay, 0s);
    opacity: 0;
  }
</style>